package test.beast.evolution.substitutionmodel;

import beast.core.parameter.RealParameter;
import beast.evolution.substitutionmodel.K80Diploid;
import org.junit.Test;

import static org.junit.Assert.assertArrayEquals;

public class K80DiploidTest {
    private static double DELTA = 1e-10;

    private K80Diploid model;
    private int nrOfStates;

    public void setupModel(Double kappa, Double lambdaL) {
        model = new K80Diploid();
        model.initByName(
                "kappa", new RealParameter(kappa.toString()),
                "lambdaL", new RealParameter(lambdaL.toString())
        );
        nrOfStates = model.getStateCount();
    }

    @Test
    public void testTransitionLong() {
        double t = 10;
        setupModel(3.0, 2.0);
        double[] expected = new double[] {
                0.166082892204, 0.0558540893483, 0.0926481768687, 0.0558540893483, 0.139413971453, 0.0552565272733, 0.0777225228670, 0.162497231911, 0.0552565272733, 0.139413971453,
                0.152747618033, 0.0558553505254, 0.0851846083342, 0.0555564162580, 0.152747618033, 0.0555564162580, 0.0851846083342, 0.150954931808, 0.0552575006077, 0.150954931808,
                0.164290061456, 0.0555553083108, 0.0926481780728, 0.0555553083108, 0.139413971453, 0.0555553083108, 0.0777225228670, 0.164290061456, 0.0555553083108, 0.139413971453,
                0.152747618033, 0.0555564162580, 0.0851846083342, 0.0558553505254, 0.150954931808, 0.0552575006077, 0.0851846083342, 0.150954931808, 0.0555564162580, 0.152747618033,
                0.139413971453, 0.0558540893483, 0.0777225228670, 0.0552565272733, 0.166082892204, 0.0558540893483, 0.0926481768687, 0.139413971453, 0.0552565272733, 0.162497231911,
                0.150954931808, 0.0555564162580, 0.0851846083342, 0.0552575006077, 0.152747618033, 0.0558553505254, 0.0851846083342, 0.152747618033, 0.0555564162580, 0.150954931808,
                0.139413971453, 0.0555553083108, 0.0777225228670, 0.0555553083108, 0.164290061456, 0.0555553083108, 0.0926481780728, 0.139413971453, 0.0555553083108, 0.164290061456,
                0.162497231911, 0.0552565272733, 0.0926481768687, 0.0552565272733, 0.139413971453, 0.0558540893483, 0.0777225228670, 0.166082892204, 0.0558540893483, 0.139413971453,
                0.150954931808, 0.0552575006077, 0.0851846083342, 0.0555564162580, 0.150954931808, 0.0555564162580, 0.0851846083342, 0.152747618033, 0.0558553505254, 0.152747618033,
                0.139413971453, 0.0552565272733, 0.0777225228670, 0.0558540893483, 0.162497231911, 0.0552565272733, 0.0926481768687, 0.139413971453, 0.0558540893483, 0.166082892204

        };
        double[] observed = new double[nrOfStates * nrOfStates];
        model.getTransitionProbabilities(null, t, 0, 1, observed);
        assertArrayEquals(expected, observed, DELTA);
    }
}
